{"componentChunkName":"component---src-templates-blog-post-js","path":"/aspect-oriented-programming/","result":{"data":{"site":{"siteMetadata":{"title":"Jason Yang's Blog"}},"markdownRemark":{"id":"37d5d7d1-e146-5cc4-98e6-a442712e83a9","excerpt":"AOP 被认为是对 OOP 的一个强大的补充，有了 AOP，我们可以把之前分散在应用各处的行为放在可重用的模块中，可以有效减少冗余代码，并让我们的类只关注自身的主要功能。 AOP 概述 面向切面编程（aspect-oriented programming…","html":"<blockquote>\n<p>AOP 被认为是对 OOP 的一个强大的补充，有了 AOP，我们可以把之前分散在应用各处的行为放在可重用的模块中，可以有效减少冗余代码，并让我们的类只关注自身的主要功能。</p>\n</blockquote>\n<h2>AOP 概述</h2>\n<p>面向切面编程（aspect-oriented programming），是一种将横切关注点与业务逻辑分离的编程方式。每个横切关注点都集中在一个地方，而不是分散在多处代码中。这样使我们的服务模块更加简洁，因为它们只包含了主要关注点的代码，而次要的功能或者说辅助的功能被转移到切面中了。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2f4e0193d1fbcc4a0d5c4c4981af66fe/82158/aop-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.36708860759494%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChklEQVR42nWSW0+SAQCGv1/RVYerfkJ3nbTDKo1ybZR20aqtumlzFRUlTU07RwfMQylhVB6ixLIDkiydNlRQUfqKOAlEEJCAMEhFnjbr1nd7b57tuXsElllucYFwwsfCYg5yaXKpb/94Jsl81LOchhCd/YPFl2I8kGbcn2bMn8IWyDLgcKN4cxCjI4Dr2wdm+9cyHATR1ElQuYuRYA6rdwbrdGLpI544wZksQo/1B+tkXWyS69kg72azooctNYPseTDEsWf72K4a5nxLK96eVWxU+am8Uc+IooDCOg8S1STFKjuSOjuFt21oh34ifAkkUb5zUmdwojK4UBmc1BsD3Ou1ceLRXm70iugMOqzP1nBvIEmb5jF95wq4P/Cbho/T1Pf5aTD5uWuYZtg1g2Cyh5DUvqdM+QnpTSOld/opvfuZQw/7OdpcQpl6lFqtlomOVUg1P7imbMR0bjNlGh9H1HYOq0WOPhY50DjFS0sIYdgZ42SLGdmTUU63jiDTWpBpbZzvNFOuk1Kum6DldRuh3tWU6yNompv5WrOV0/oQFa++c/GVi4ouF2c6vmO0RxEsnhlkT8epaLdxoW2cis5JFC8cXOoeo/yFlLNdk7S+7SDcu4azb2Jo1WrEmm3Ie8JU6Z1Udrupeu1GrnPSJ0YRjFMRtlYbKap+S9HlDxTVGii+0o+0aZDjz0vY3WCmUqPB924lOxt9XL31gDHFRnY3eSlt+sL+JpHShyIS1RTt5hBCZi5HZHaeWDpHNJ0jkpojnoEJn8iplzswTztIuJ+SNq0gmEwRNDYTur6eYGyWSHKOX/EMvxJZwvEM6ewCwnKB5vN5Qgkvi/n8/7AdS3wxm2Q+5ls27L/5qoFdmO26owAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aop-demo\"\n        title=\"\"\n        src=\"/static/2f4e0193d1fbcc4a0d5c4c4981af66fe/f058b/aop-1.png\"\n        srcset=\"/static/2f4e0193d1fbcc4a0d5c4c4981af66fe/c26ae/aop-1.png 158w,\n/static/2f4e0193d1fbcc4a0d5c4c4981af66fe/6bdcf/aop-1.png 315w,\n/static/2f4e0193d1fbcc4a0d5c4c4981af66fe/f058b/aop-1.png 630w,\n/static/2f4e0193d1fbcc4a0d5c4c4981af66fe/82158/aop-1.png 696w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>上图表示划分为三个服务模块的应用，每个模块提供相应的服务，而且这些模块都需要类似的辅助功能，例如日志、安全、事务等等。我们并不想在各个模块中写重复的日志、安全、事务的代码，那么就可以使用选用切面这个方案，来解决这个问题。</p>\n<h2>AOP 术语</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 552px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5030ef0a87877df7e90d9832847a7dce/08c0b/aop-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVR42q2S3WsTQRTF+4f75JMgFHwRlL6JSoWaEpNojWma2W38IpmmkaQt1jYmS9LIfhHYZD9mfrKbTaqQPggOHO7MnMOZO/feLf7z2rqLOJu0EBdF6t19RL+IcV7G/F7C8i4zXmv9b4btYY03nac8KW+zvfeQF+Ixld4OP351Mz6OI5IkQSmVYW2YPrQJSi0zkD2fnd1rrJtFdl7djyyL4XDEYPATz/NzO/1nhnoddbZXRLFmr9zj3oMK5pdRrlHr787nAWEY5iXIM1xEihRBpJlH+q8YhJpC1eL+o8+YbYdIQRDm2lhjuz6zIOJ6Or81LDQnvDJdamKfotHnvTigZLSoNgoUzXMORYFnlT6NZokDccRbYfBO1KmIJi8bNq+PJzw/HNO9mi0N6x2HqvT5eNLiSA45ll3EySVfu6eI0zGNTybGtzFN2caUfQx5hil7GPKCWmfGB2mzK24YTBd3dzmtke34OLbNdGrjuQ4qSTZOg0q1s3hTl/Nia52NQWrmuh6+5+J5HkkSZ9xKt8RtM1aGvwGfpO/2ceVE/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aop-demo\"\n        title=\"\"\n        src=\"/static/5030ef0a87877df7e90d9832847a7dce/08c0b/aop-2.png\"\n        srcset=\"/static/5030ef0a87877df7e90d9832847a7dce/c26ae/aop-2.png 158w,\n/static/5030ef0a87877df7e90d9832847a7dce/6bdcf/aop-2.png 315w,\n/static/5030ef0a87877df7e90d9832847a7dce/08c0b/aop-2.png 552w\"\n        sizes=\"(max-width: 552px) 100vw, 552px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>\n<p><code>advice</code> - 通知</p>\n<ul>\n<li>\n<blockquote>\n<p>切面的具体行为，即要切入执行的代码</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p><code>pointcut</code> - 切点</p>\n<ul>\n<li>\n<blockquote>\n<p>通知被应用的具体位置</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p><code>join point</code> - 连接点</p>\n<ul>\n<li>\n<blockquote>\n<p>程序运行时，能够应用通知的所有点</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p><code>aspect</code> - 切面</p>\n<ul>\n<li>\n<blockquote>\n<p>什么时候在什么地方做什么事情，是切点和通知的结合</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p><code>target</code> - 目标对象</p>\n<ul>\n<li>\n<blockquote>\n<p>被切入功能的目标对象</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p><code>introduction</code> - 引入</p>\n<ul>\n<li>\n<blockquote>\n<p>将新的方法或属性引入到现有的类中</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p><code>weaving</code> - 织入</p>\n<ul>\n<li>\n<blockquote>\n<p>把切面应用到目标对象并创建新的代理对象的过程</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n<h2>代理模式</h2>\n<p>代理模式是使用代理对象完成用户请求，屏蔽用户对真实对象访问的一种设计模式。现实生活中，代理人被授权执行当事人的一些事宜，无需当事人出面，从第三方的角度看，他只和代理人通信。而事实上代理人是要有当事人的授权，并且在核心问题上还需要请示当事人。</p>\n<p>AOP 就是使用代理模式实现的，其中的代理类就相当于AOP中的切面。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 533px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/41018c766a2b8eadd4241117d2b44252/a1aa0/aop-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABbElEQVR42o2R3ytDARTH75N/Q6TkwZNHK0mSB6tRnlZseWFN1h54QH48UMqPkpelyFbLr9TKj0hYzY+UlGRDErFifm333m13937kmh8r4tQ5fet8z/eczlfg36HpVVVV4kmJeDKOpqU7HwAQMuk/ybx3nqJ3LOyPMLBSQ9eSgZ6lEkY36/GfTqOkEp9sQUuJKOIpmnxGSgyhKVFdQlEUEokEshQnHLmmd8GExZWNdbQMy7CVhjErNreBRm8OUzvtXxcq4SliawLn81k8LgrELoaIyiCJL4hSTCf5QzM0z+Vidzkx2g4or1umwrJOtSOAw23COV/IVSSUFnwKIB9V83xoRjysIhlZRdWvT6FqOiJ4u4d9Op+miUrM3ePUti5S2+ajvn+QJk8Rnb5SXqSHzB/+ZcZW0EuHr5jmmVxs3gJs3nxaZvPoWzYSDO+mzVHfBN8G1G+p/W6MdM/B5RrrJ5NsBD0c32wjJ8WMxa9pIuYFmlSydwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aop-demo\"\n        title=\"\"\n        src=\"/static/41018c766a2b8eadd4241117d2b44252/a1aa0/aop-3.png\"\n        srcset=\"/static/41018c766a2b8eadd4241117d2b44252/c26ae/aop-3.png 158w,\n/static/41018c766a2b8eadd4241117d2b44252/6bdcf/aop-3.png 315w,\n/static/41018c766a2b8eadd4241117d2b44252/a1aa0/aop-3.png 533w\"\n        sizes=\"(max-width: 533px) 100vw, 533px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>静态代理</h3>\n<p>之所以称为静态代理，是因为在程序运行前，代理类就已经存在了。</p>\n<p><strong>举个例子</strong></p>\n<p>一般艺人都需要助理，来帮他跑腿，演出前谈价格，演出后收钱，只有表演的时候艺人才亲自出马。</p>\n<ol>\n<li>\n<p>定义一个艺人接口</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.staticproxy;\n\n/**\n * 艺人接口\n * @author jason\n * @date 2019/2/14.\n */\npublic interface Artist {\n    /**\n     * 表演\n     */\n    void perform();\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>定义艺人实现类刘德华</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.staticproxy;\n\n/**\n * 艺人刘德华\n *\n * @author jason\n * @date 2019/2/14.\n */\npublic class LiuDehua implements Artist {\n\n    private LiuDehua() {\n    }\n\n    public static LiuDehua getInstance() {\n        return new LiuDehua();\n    }\n\n    public void perform() {\n        System.out.println(&quot;刘德华出场演唱笨小孩...&quot;);\n    }\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>编写代理类</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.staticproxy;\n\n/**\n * 艺人助理（代理类）\n *\n * @author jason\n * @date 2019/2/14.\n */\npublic class ArtistProxy implements Artist {\n\n    private LiuDehua liuDehua;\n\n    private ArtistProxy() {\n    }\n\n    public ArtistProxy(LiuDehua liuDehua) {\n        this.liuDehua = liuDehua;\n    }\n\n\n    public void perform() {\n        System.out.println(&quot;助理出面谈价格，签合同...&quot;);\n        liuDehua.perform();\n        System.out.println(&quot;助理出面收钱...&quot;);\n    }\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>运行<code>main</code>方法，将艺人实例传入代理类的构造方法，然后调用代理类的<code>perform()</code></p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.staticproxy;\n\n/**\n * @author jason\n * @date 2019/2/14.\n */\npublic class StaticProxyDemo {\n\n    public static void main(String[] args) {\n        LiuDehua liuDehua = LiuDehua.getInstance();\n        ArtistProxy proxy = new ArtistProxy(liuDehua);\n        proxy.perform();\n    }\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>运行结果</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">助理出面谈价格，签合同...\n刘德华出场演唱笨小孩...\n助理出面收钱...\n\nProcess finished with exit code 0</code>\n        </deckgo-highlight-code>\n</li>\n</ol>\n<p><strong>静态代理的缺点</strong></p>\n<p>假设主题接口中的方法很多，为每一个接口写一个代理方法也很麻烦。如果接口有变动，则真实主题和代理类都要修改，不利于系统维护；</p>\n<h3>动态代理</h3>\n<p>动态代理是在程序运行时，利用Java反射机制动态的生成代理类的代理模式。</p>\n<h4>Jdk动态代理</h4>\n<ul>\n<li>JDK的动态代理依靠接口实现</li>\n<li>如果类并没有实现接口，则不能使用Jdk的动态代理</li>\n</ul>\n<ol>\n<li>\n<p>定义图书服务接口</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.jdkproxy;\n\n/**\n * 图书服务接口\n * @author jason\n * @date 2019/2/14.\n */\npublic interface BookService {\n    /**\n     * 新增图书接口\n     */\n    void addBook();\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>编写图书服务实现类</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.jdkproxy;\n\n/**\n * 图书服务实现类\n * @author jason\n * @date 2019/2/14.\n */\npublic class BookServiceImpl implements BookService {\n    @Override\n    public void addBook() {\n        System.out.println(&quot;新增图书&quot;);\n    }\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>编写InvocationHandler实现类</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.jdkproxy;\n\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\n\n/**\n * JDK 动态代理\n * @author jason\n * @date 2019/2/14.\n */\npublic class BookServiceInvocationHandler implements InvocationHandler {\n\n    private Object target;\n\n\n    public BookServiceInvocationHandler(Object target){\n        this.target = target;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        System.out.println(&quot;事务开始&quot;);\n        Object result = method.invoke(target, args);\n        System.out.println(&quot;事务结束&quot;);\n        return result;\n    }\n}\t</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>运行测试程序</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.jdkproxy;\n\nimport java.lang.reflect.Proxy;\n\n/**\n * JDK动态代理演示\n *\n * @author jason\n * @date 2019/2/14.\n */\npublic class JdkProxyDemo {\n    public static void main(String[] args) {\n        BookServiceInvocationHandler invocationHandler = new BookServiceInvocationHandler(new BookServiceImpl());\n\n        // JDK 动态代理只支持接口\n        BookService bookServiceProxy = (BookService) Proxy.newProxyInstance(\n                BookServiceImpl.class.getClassLoader(),\n                BookServiceImpl.class.getInterfaces(),\n                invocationHandler);\n\n        bookServiceProxy.addBook();\n    }\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>运行结果</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">事务开始\n新增图书\n事务结束\n\nProcess finished with exit code 0</code>\n        </deckgo-highlight-code>\n</li>\n</ol>\n<h4>CGLIB动态代理</h4>\n<p>JDK的动态代理依靠接口实现，如果有些类并没有实现接口，则不能使用JDK代理，这时就要使用cglib动态代理了。使用cglib需要依赖<code>cglib</code>的jar，使用maven为例</p>\n<deckgo-highlight-code language=\"xml\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">&lt;dependency&gt;\n  &lt;groupId&gt;cglib&lt;/groupId&gt;\n  &lt;artifactId&gt;cglib-nodep&lt;/artifactId&gt;\n  &lt;version&gt;3.2.4&lt;/version&gt;\n&lt;/dependency&gt;</code>\n        </deckgo-highlight-code>\n<ol>\n<li>\n<p>定义图书服务类</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.cglibproxy;\n\n/**\n * @author jason\n * @date 2019/2/14.\n */\npublic class BookService {\n    public void addBook() {\n        System.out.println(&quot;新增图书&quot;);\n    }\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>编写MethodInterceptor实现类</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.cglibproxy;\n\nimport net.sf.cglib.proxy.MethodInterceptor;\nimport net.sf.cglib.proxy.MethodProxy;\nimport java.lang.reflect.Method;\n\n/**\n * @author jason\n * @date 2019/2/14.\n */\npublic class BookServiceMethodInterceptor implements MethodInterceptor {\n\n    @Override\n    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {\n        System.out.println(&quot;事务开始&quot;);\n        methodProxy.invokeSuper(o, objects);\n        System.out.println(&quot;事务结束&quot;);\n        return null;\n    }\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>运行测试程序</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">package org.nocoder.proxy.cglibproxy;\n\nimport net.sf.cglib.proxy.Enhancer;\n\n/**\n * @author jason\n * @date 2019/2/14.\n */\npublic class CglibProxyDemo {\n    public static void main(String[] args) {\n        BookServiceMethodInterceptor cglibInterceptor = new BookServiceMethodInterceptor();\n        //cglib 强化剂\n        Enhancer enhancer = new Enhancer();\n        enhancer.setSuperclass(BookService.class);\n        // 创建代理对象\n        enhancer.setCallback(cglibInterceptor);\n        BookService bookServiceProxy = (BookService)enhancer.create();\n        bookServiceProxy.addBook();\n    }\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>运行结果</p>\n<deckgo-highlight-code language=\"shell\" terminal=\"carbon\" theme=\"one-dark\" line-numbers=\"true\"  >\n          <code slot=\"code\">事务开始\n新增图书\n事务结束\n\nProcess finished with exit code 0</code>\n        </deckgo-highlight-code>\n</li>\n</ol>\n<h2>Spring AOP</h2>\n<p>Spring 提供了4中 aop 的支持，基于代理的经典SpringAOP，纯POJO切面，@Aspect注解驱动的切面，注入式AspectJ切面。前三种都是SpringAOP实现的变体，SpringAOP构建在动态代理基础之上，因此，Spring对AOP的支持局限于方法拦截。第四种实际是使用AspectJ的解决方案。提供了SpringAOP所不能支持的许多类型的切点。我们可以借助Spring的依赖注入把bean装配进AspectJ切面中。Spring借鉴了AspectJ的切面，以提供注解驱动的AOP。本质上，它依然是Spring基于代理的AOP。</p>\n<h4>使用<code>@Aspect</code>创建切面类</h4>\n<p>Audience类使用<code>@Aspect</code>注解进行了标注。该注解表明Audience不仅仅是一个POJO，还是一个切面。Audience类中的方法都使用注解来定义切面的具体行为。Audience有四个方法，定义了一个观众在观看演出时可能会做的事情。在演出之前，观众要就坐（takeSeats()）并将手机调至静音状态（silenceCellPhones()）。如果演出很精彩的话，观众应该会鼓掌喝彩（applause()）。不过，如果演出没有达到观众预期的话，观众会要求退款（demandRefund()）。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4f0838d7d2f183bec5f1a7c408ab279b/47ff6/aspect-execution.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA30lEQVR42o2R2QqDQAxF/f8PFNwQfHBfcF9QU05oLH0pDYTM3ElOEnXkbfd9y7Issm2brOsq53mqPs/z46ZN0yR1Xct1XdL3vQzDIF3Xaa1jQCC+70sUReJ5nozjqAVBEIjruqoBwmgMkBrywzDU97ZtP0C6A8ApYCLicRzaed93jWg4DckxnQ0xBQKpqkrKstTOOKvkea560zTPGxp3zrwRDf4AoTMhIhPhdLburIZzZm0ARPIYxqIC7cMWRSFZlqkzwS+z9ZIkkTiOv/IVyB9K01RhRFb5x5iSYWxdgC+SrB0bQcljlAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aspect-execution\"\n        title=\"\"\n        src=\"/static/4f0838d7d2f183bec5f1a7c408ab279b/f058b/aspect-execution.png\"\n        srcset=\"/static/4f0838d7d2f183bec5f1a7c408ab279b/c26ae/aspect-execution.png 158w,\n/static/4f0838d7d2f183bec5f1a7c408ab279b/6bdcf/aspect-execution.png 315w,\n/static/4f0838d7d2f183bec5f1a7c408ab279b/f058b/aspect-execution.png 630w,\n/static/4f0838d7d2f183bec5f1a7c408ab279b/47ff6/aspect-execution.png 852w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/02e39b25fa3ea3ba8a8ab4b275b90103/b12f7/aspect-annotation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.84810126582278%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABgElEQVR42pWUjY6CMBCE+/7PSEwI/6IgoCCKrvl6GYJwXjySTdttd7szs8Udj0frus6aprHz+WyPx2O25/P5tsamabK/PhcEgZVlaWEY2m63s/1+b3Ece0uSxNI0tSiK/Jp5VVWbJFyM+YR5nvvqiqKYA/DJuICEdV2/BX6sMMsy6/ve7ve73W43b0D79uOCy+ViwzD8JDwcDta2ra+S6k6nk98cx3E2ra/Xqzcuh0uS4QcJWrB28EdSHIyaQwHGBVQACo0kEZI1GscGKlOFgmSojo+qmHNmzSGVsi/1HckERcFcIp/8S1tyDVV0AxfOKuNAHEYUBSpUiFvG3zhUr24gr0WQEAQzckaKrvtukxARqAaFJRAjlZEQLqGFKhEI01wUUTFFeJXBThKCUJdkNDEJlwJ96k8QQBXnfYVqSvFDoPiSOKJELSNKxOMSuqMqnhyVIYzeMT6ggQADgdqIZBgxiKrH4CEzETxxRSCH8CuY/fWfhnOcIW7uw/+822++F3Qv2qxKhW3HAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aspect-annotation\"\n        title=\"\"\n        src=\"/static/02e39b25fa3ea3ba8a8ab4b275b90103/f058b/aspect-annotation.png\"\n        srcset=\"/static/02e39b25fa3ea3ba8a8ab4b275b90103/c26ae/aspect-annotation.png 158w,\n/static/02e39b25fa3ea3ba8a8ab4b275b90103/6bdcf/aspect-annotation.png 315w,\n/static/02e39b25fa3ea3ba8a8ab4b275b90103/f058b/aspect-annotation.png 630w,\n/static/02e39b25fa3ea3ba8a8ab4b275b90103/40601/aspect-annotation.png 945w,\n/static/02e39b25fa3ea3ba8a8ab4b275b90103/b12f7/aspect-annotation.png 1020w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>Advice的5种注解</h4>\n<table>\n<thead>\n<tr>\n<th><strong>注解</strong></th>\n<th align=\"left\"><strong>通知</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>@After</td>\n<td align=\"left\">通知方法会在目标方法返回或抛异常后调用</td>\n</tr>\n<tr>\n<td>@AfterReturning</td>\n<td align=\"left\">通知方法会在目标方法返回后调用</td>\n</tr>\n<tr>\n<td>@AfterThrowing</td>\n<td align=\"left\">通知方法会在目标方法抛异常后调用</td>\n</tr>\n<tr>\n<td>@Around</td>\n<td align=\"left\">通知方法会将目标方法封装起来</td>\n</tr>\n<tr>\n<td>@Before</td>\n<td align=\"left\">通知方法会在目标方法调用之前执行</td>\n</tr>\n</tbody>\n</table>\n<h4>使用<code>@Pointcut</code>声明切点表达式</h4>\n<p>@Pointcut 声明使用频繁的切点表达式后，在通知注解中引用即可</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a99c320af39d8816b005834866a351d/ad997/pointcut.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.0759493670886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABf0lEQVR42p2T6Y6CQBCEef835BeX4IWCijfQ5uukzKwrutlJyrmc6uquJjoej7bZbOxwOFjTNHY6nex+v0/idrvZMAw2NSJIsiyz9XptaZpaVVW2XC6tKAory9IWi4WD/Xw+d0A6Sdi2rf+5rusnIeBsNps5AcTsyebbiJTy+Xz2B8xakz5gz3y5XN6S9H3v98zRfr93FdSw6zrb7Xa+5nIcR69XCM6B9gzex3HsNY44ROF2u3VQSwAxwQgCWCsouF6vTgC5Zk+ZBbWCFCIMoIbslYYGiqWO9dsa8oMyTMFxiFgzr1arJzE1RaEc5r+kitIfhETiAReAwisd7gTVTnv15KtSr6F6TP2mvlST66GIRDyZspTxUOAsbJtPX8cvhdQqdFn1xFkCvarjDU6TDQHfmgIRJJCz5gvCBAAxpkD4VSGRSUmmhOYAkYRNrjfqgjCQE+q7pf/yPLckSdwYjEIdNUUhAUTKGWlzHtb3aYpaJTRGKlmj6E8pf+r6/4wHslcrYZnXe9YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pointcut\"\n        title=\"\"\n        src=\"/static/0a99c320af39d8816b005834866a351d/f058b/pointcut.png\"\n        srcset=\"/static/0a99c320af39d8816b005834866a351d/c26ae/pointcut.png 158w,\n/static/0a99c320af39d8816b005834866a351d/6bdcf/pointcut.png 315w,\n/static/0a99c320af39d8816b005834866a351d/f058b/pointcut.png 630w,\n/static/0a99c320af39d8816b005834866a351d/40601/pointcut.png 945w,\n/static/0a99c320af39d8816b005834866a351d/ad997/pointcut.png 1012w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>总结</h2>\n<ul>\n<li>面向切面编程是面向对象编程的一个强大的补充</li>\n<li>通过切面可以把分散在应用各处的行为放入可重用的模块中</li>\n<li>通过注解显示的声明在什么地方应用该行为</li>\n<li>有效减少冗余代码，让我们的类关注自身的主要功能</li>\n<li>动态代理模式和静态代理模式</li>\n<li>通过使用@Aspect注解和简单的配置，可以很简单的在Spring中装配advice和pointcut</li>\n</ul>\n<h2>参考文献</h2>\n<ul>\n<li>\n<p>Spring 实战（第4版）</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bdc0657875cd67678ffd44015b81d107/c7dcc/spring-in-action.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABGnAAARpwHTd0PhAAACgUlEQVR42n2T30sUURzF92+JoIdeegmSCougBzUzMZUMtbIyIypIjH5QKAhh9CJB6T4UVK4KghYqPVT2UGIvYrrNru5q4/6c2VnXdVtnZkc/ce9mD7HtwIG533vvued877muZDKJaZqk02lyuRzRaFRC1MV4cXGReDxOKBSSdcdxKPa5BgY8TE5OMjU1hcfjYXh4iKHBQSYnJiSp2+3m7dgYfX19jI+Pk81m5cbt7e3ChFo8ihaPkNlIoWsam5smlm1JJbZtSwI757BpmmRNC9vZwrQdiYKErU1lVJeXcKWljmxGI7u2jPUrCpgkEgbLy8uoeholnMSr6vjDBguqji+c/KP0X8L6/TSW76azvYYvo/0M9d7Fdiws25SWvV4veiJBIBhkenpajr/NzKDrekHrrgc3a3h0u5buW1U86zjFufNljLzpQpn/zFpqA7/fRyQSZmH+O4qi8FNVmZ2dRYvHUVVVHiDqc3Nz8mJdF5trOFt/guaGk3wYfUldxT76nj4EZxNNT7C0tEQguoYSMljbyF+I42yxtZWH6PUOhFrXtZZKWuqPcPVSLWP9PXReL0P58VVu1HUNn8+HGo4y51UIhyNkMpnisWltrqCh+jAtjZW8ftKB+/EFPn18JSdjsRiK4mN1VSWVSkkVQlVRwuryAxwv3UtD1SF67p1mbKiDEc99nJyFYSRlnwRisTjBYJD19fXiOTx2cA9HS3bR1lSK50UXUxO9vH/3nIQWImEkZWwCgQArKysYhvE32P9VeKf9MjfaztDd2S5jspFOYyRTMtTCst/vlxC9FOrEGvEMxXxBwp0fYUH0J28lb0dcgFAlIN6zOEDTNNkCy7IKEv4GfZaV3nzzTPcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spring-in-action\"\n        title=\"\"\n        src=\"/static/bdc0657875cd67678ffd44015b81d107/f058b/spring-in-action.png\"\n        srcset=\"/static/bdc0657875cd67678ffd44015b81d107/c26ae/spring-in-action.png 158w,\n/static/bdc0657875cd67678ffd44015b81d107/6bdcf/spring-in-action.png 315w,\n/static/bdc0657875cd67678ffd44015b81d107/f058b/spring-in-action.png 630w,\n/static/bdc0657875cd67678ffd44015b81d107/c7dcc/spring-in-action.png 641w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>Head First 设计模式</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 578px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef40ceb3747e4ddb28236fe0e1cd7a75/508ef/head-first-design-pattern.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABFwAAARcAESNTyuAAACrElEQVR42oWTXW/aSBSG/Wervai6V3vR60qJWm1vNh+tqkp02xVqV60iEQitkiYkCiENJMSGENs4YBrAdgBjg/lIHMyzsvdL2araIx3paEbnmffMvCOoqsrOzg75fJ7Dw8Mos9ksBwcHKIpCOp2O1jKZDLFYjPX1JJqm0e/32draIpfLsb+/Tzwep1AoINi2TQgVxVPK5TJXV1eYphnVhmFEB9VqNRRFJrOzjVgsYhoGnuchiiKyLCNJEpubmxFHkBWV+Nt3JFMbkYpwYyOd5vf3H9hIf2Q0GjHyPMbXt9hjn87Ip9Wf4M8C/hvz+RxBKpV4/eY3VlZXWV5e4vnzZywt/ULs1WsSyRSdThetqtKyehSrl+SkKkfyJb2+g+s6BEEQgf5O4fb2NqJfaDp7mRzra9vsbueizTBc1+X8/JxW26BWq3NSKPBV15GkEkeFY0aT6R2Vws3NDaOxx1G2zHFeZHc3iyxrqHKNgTvCcR1URcHoDZANF707pHY1pGqGtUez590F+r6P2bZoNLr8+uQhH57+wMBukds7Q5MvmU7HkcLwgSqVCuWzMxzHiZqD+bf3KEzGE07zKpbZ5s2je3x58YB6IUWnZ0eN4cihfer1OpZl/XP53wvhejrFtGwOP77jU2wB7dMqtVyc0y+n1DWDoedGsDBD/7UNg1kQ/AX+M+8Ag2DG10aPk88Jjva2MC+OUU5EWpcdZjOf0KehDxu6TkkSGbgO8yD4vsJiscjKyjJPHy+yuLDITz/e58nCz7x8+YpEIhEZPVRmdW0qWoPBxMcd3+BNfWzvms7grieF0Olra2vRl0omk5GhQ1AqlYq+ZLfbpdVsYtkDynWTotqkdNGiUm9TrDbRTIepP/sXyP/EcDhE13Us00Q5r1BVVcqSyFlJot1qfjPyH8WTpVU8+d82AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"head-first-dp\"\n        title=\"\"\n        src=\"/static/ef40ceb3747e4ddb28236fe0e1cd7a75/508ef/head-first-design-pattern.png\"\n        srcset=\"/static/ef40ceb3747e4ddb28236fe0e1cd7a75/c26ae/head-first-design-pattern.png 158w,\n/static/ef40ceb3747e4ddb28236fe0e1cd7a75/6bdcf/head-first-design-pattern.png 315w,\n/static/ef40ceb3747e4ddb28236fe0e1cd7a75/508ef/head-first-design-pattern.png 578w\"\n        sizes=\"(max-width: 578px) 100vw, 578px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p><a href=\"https://zh.wikipedia.org/wiki/%E9%9D%A2%E5%90%91%E4%BE%A7%E9%9D%A2%E7%9A%84%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1\">https://zh.wikipedia.org/wiki/%E9%9D%A2%E5%90%91%E4%BE%A7%E9%9D%A2%E7%9A%84%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1</a></p>\n</li>\n<li>\n<p><a href=\"https://zh.wikipedia.org/wiki/%E6%A8%AA%E5%88%87%E5%85%B3%E6%B3%A8%E7%82%B9\">https://zh.wikipedia.org/wiki/%E6%A8%AA%E5%88%87%E5%85%B3%E6%B3%A8%E7%82%B9</a></p>\n</li>\n<li>\n<p><a href=\"https://juejin.im/post/5b06bf2df265da0de2574ee1\">https://juejin.im/post/5b06bf2df265da0de2574ee1</a></p>\n</li>\n<li>\n<p><a href=\"http://www.cnblogs.com/jqyp/archive/2010/08/20/1805041.html#3460821\">http://www.cnblogs.com/jqyp/archive/2010/08/20/1805041.html#3460821</a></p>\n</li>\n<li>\n<p><a href=\"http://blog.didispace.com/springbootaoplog/\">http://blog.didispace.com/springbootaoplog/</a></p>\n</li>\n</ul>","frontmatter":{"title":"面向切面编程","date":"2019年02月14日 21:37:41","description":"面向切面编程知识点整理。"}},"previous":{"fields":{"slug":"/about-logging/"},"frontmatter":{"title":"关于日志的那些事儿"}},"next":{"fields":{"slug":"/principles-of-good-programming/"},"frontmatter":{"title":"编程原则"}}},"pageContext":{"id":"37d5d7d1-e146-5cc4-98e6-a442712e83a9","previousPostId":"9ee5a243-d7af-5d21-bfe3-46d91c4b656c","nextPostId":"d3a8b803-b5e0-5902-9b7b-c46c25d277b2"}},"staticQueryHashes":["3274528899","3589320610"],"slicesMap":{}}