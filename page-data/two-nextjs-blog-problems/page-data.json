{"componentChunkName":"component---src-templates-blog-post-js","path":"/two-nextjs-blog-problems/","result":{"data":{"site":{"siteMetadata":{"title":"Funny Eagle","author":"Jason Yang"}},"markdownRemark":{"id":"8e5aa5c9-504d-5abe-9b6a-d72e24928867","excerpt":"晚上加班的时候喝了一瓶东鹏，回到家睡不着觉，想起博客有个路由问题还没解决，挑灯疯狂Google，终于找到了解决办法。 问题一，我基于  搭建的博客，配置好之后 ，把生成的静态文件直接配在nginx下…","html":"<p>晚上加班的时候喝了一瓶东鹏，回到家睡不着觉，想起博客有个路由问题还没解决，挑灯疯狂Google，终于找到了解决办法。</p>\n<p>问题一，我基于 <code class=\"language-text\">Tailwind Nextjs Starter Blog</code> 搭建的博客，配置好之后 <code class=\"language-text\">yarn build</code>，把生成的静态文件直接配在nginx下。</p>\n<p>OK，看似一切正常，然而在文章页面刷新或者直接复制粘贴文章链接访问，就直接到我配置的404页面了。。。</p>\n<p>检查了nginx的配置，没有问题，所以我猜可能是路由的问题，搜到了以下两个链接，试着配了以下，问题解决。</p>\n<p><a href=\"https://stackoverflow.com/questions/54815348/nextjs-page-goes-to-404-on-refresh\">nextjs-page-goes-to-404-on-refresh</a></p>\n<p><a href=\"https://stackoverflow.com/questions/62208254/nextjs-404-error-on-reload-refresh-action\">nextjs-404-error-on-reload-refresh-action</a></p>\n<p>在<code class=\"language-text\">next.config.js</code> 配置 <code class=\"language-text\">exportTrailingSlash: true</code>，然后重新打包即可。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> plugins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>withContentlayer<span class=\"token punctuation\">,</span> withBundleAnalyzer<span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">return</span> plugins<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acc<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">reactStrictMode</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">pageExtensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tsx'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'jsx'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'md'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mdx'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">eslint</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">dirs</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'components'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'layouts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'scripts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">images</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">unoptimized</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token function\">headers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span> <span class=\"token string\">'/(.*)'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> securityHeaders<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">webpack</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.svg$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@svgr/webpack'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">return</span> config\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token string\">'export'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">exportTrailingSlash</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>问题二，部署到nginx下访问，发现文章里的图片不显示，我的文章图片在mdx同路径的<code class=\"language-text\">images</code>目录下，yarn build 完之后没有这个目录，不知道在哪配置。</p>\n<p>后来把图片全部移动到<code class=\"language-text\">public</code>目录下，把引用图片的地方改成<code class=\"language-text\">![alt text](./q1.png)</code>，打包之后就能正常访问图片了。</p>","tableOfContents":"","frontmatter":{"title":"Tailwind Nextjs Starter Blog 的两个配置问题","tags":["coding"],"description":"半夜想起网站还有问题没解决，挑灯疯狂Google，终于找到了解决办法。","date":"2024-06-05"}}},"pageContext":{"slug":"/two-nextjs-blog-problems","previous":{"fields":{"slug":"/rebuild-resttemplate-in-springboot"},"frontmatter":{"title":"在Springboot中重建RestTemplate Bean","tags":["coding","java"],"slug":"/rebuild-resttemplate-in-springboot"}},"next":{"fields":{"slug":"/architect-exam-2024"},"frontmatter":{"title":"2024年系统架构设计师考试经验和心得分享","tags":["life"],"slug":"/architect-exam-2024"}}}},"staticQueryHashes":["2052298874"],"slicesMap":{}}