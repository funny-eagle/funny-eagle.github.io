{"version":3,"sources":["../../src/schema/schema.js"],"names":["_","require","invariant","isSpecifiedScalarType","isIntrospectionType","defaultFieldResolver","assertValidName","getNamedType","Kind","ObjectTypeComposer","InterfaceTypeComposer","UnionTypeComposer","InputTypeComposer","apiRunner","report","addNodeInterfaceFields","addInferredType","addInferredTypes","findOne","findManyPaginated","getPagination","getSortInput","getFilterInput","isGatsbyType","GatsbyGraphQLTypeKind","buildSchema","schemaComposer","nodeStore","types","thirdPartySchemas","typeMapping","typeConflictReporter","parentSpan","updateSchemaComposer","schema","rebuildSchemaWithSitePage","typeComposer","getOTC","processTypeComposer","module","exports","addTypes","addSetFieldsOnGraphQLNodeTypeFields","Promise","all","Array","from","values","map","addThirdPartySchemas","addCustomResolveFunctions","hasInterface","addResolvers","addConvenienceChildrenFields","addTypeToRootQuery","forEach","typeOrTypeDef","plugin","addedTypes","addTypeDefs","error","reportParsingError","type","processAddedType","createdFrom","createTypeComposerFromGatsbyType","typeName","addAsComposer","checkIsAllowedTypeName","get","getResolveType","setResolveType","node","internal","addSchemaMustHaveType","setExtension","name","astNode","directives","directive","value","getNoDefaultResolvers","noDefaultResolvers","arguments","find","kind","BOOLEAN","endsWith","includes","OBJECT","createTemp","config","interfaces","iface","getIFTC","getType","INPUT_OBJECT","UNION","INTERFACE","warn","JSON","stringify","tc","getTypeName","result","nodes","getNodesByType","traceId","fields","addNestedFields","schemaQueryType","getQueryType","queryTC","processThirdPartyType","getFields","Query","addFields","getTypeMap","Object","keys","getAnyTC","isThirdPartyType","getFieldNames","fieldName","fieldType","getFieldType","extendField","toString","replace","intermediateSchema","createResolvers","resolvers","has","fieldConfig","hasField","originalFieldConfig","getFieldConfig","originalTypeName","originalResolver","resolve","fieldTypeName","newConfig","args","source","context","info","removeInputTypeComposer","sortInputTC","filterInputTC","paginationTC","addResolver","filter","sort","skip","limit","childNodesByType","groupChildNodesByType","typeChildren","maxChildCount","maxBy","groupBy","c","parent","g","length","createChildrenField","createChildField","camelCase","path","nodeModel","getNodesByIds","ids","children","flatMap","getNode","undefined","queryName","queryNamePlural","getResolver","message","locations","codeFrameColumns","frame","body","start","linesAbove","linesBelow","panic"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst invariant = require(`invariant`)\nconst {\n  isSpecifiedScalarType,\n  isIntrospectionType,\n  defaultFieldResolver,\n  assertValidName,\n  getNamedType,\n  Kind,\n} = require(`graphql`)\nconst {\n  ObjectTypeComposer,\n  InterfaceTypeComposer,\n  UnionTypeComposer,\n  InputTypeComposer,\n} = require(`graphql-compose`)\nconst apiRunner = require(`../utils/api-runner-node`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst { addNodeInterfaceFields } = require(`./types/node-interface`)\nconst { addInferredType, addInferredTypes } = require(`./infer`)\nconst { findOne, findManyPaginated } = require(`./resolvers`)\nconst { getPagination } = require(`./types/pagination`)\nconst { getSortInput } = require(`./types/sort`)\nconst { getFilterInput } = require(`./types/filter`)\nconst { isGatsbyType, GatsbyGraphQLTypeKind } = require(`./types/type-builders`)\n\nconst buildSchema = async ({\n  schemaComposer,\n  nodeStore,\n  types,\n  thirdPartySchemas,\n  typeMapping,\n  typeConflictReporter,\n  parentSpan,\n}) => {\n  await updateSchemaComposer({\n    schemaComposer,\n    nodeStore,\n    types,\n    thirdPartySchemas,\n    typeMapping,\n    typeConflictReporter,\n    parentSpan,\n  })\n  // const { printSchema } = require(`graphql`)\n  const schema = schemaComposer.buildSchema()\n  // console.log(printSchema(schema))\n  return schema\n}\n\nconst rebuildSchemaWithSitePage = async ({\n  schemaComposer,\n  nodeStore,\n  typeMapping,\n  typeConflictReporter,\n  parentSpan,\n}) => {\n  const typeComposer = addInferredType({\n    schemaComposer,\n    typeComposer: schemaComposer.getOTC(`SitePage`),\n    nodeStore,\n    typeConflictReporter,\n    typeMapping,\n    parentSpan,\n  })\n  await processTypeComposer({\n    schemaComposer,\n    typeComposer,\n    nodeStore,\n    parentSpan,\n  })\n  return schemaComposer.buildSchema()\n}\n\nmodule.exports = {\n  buildSchema,\n  rebuildSchemaWithSitePage,\n}\n\nconst updateSchemaComposer = async ({\n  schemaComposer,\n  nodeStore,\n  types,\n  typeMapping,\n  thirdPartySchemas,\n  typeConflictReporter,\n  parentSpan,\n}) => {\n  await addTypes({ schemaComposer, parentSpan, types })\n  await addInferredTypes({\n    schemaComposer,\n    nodeStore,\n    typeConflictReporter,\n    typeMapping,\n    parentSpan,\n  })\n  await addSetFieldsOnGraphQLNodeTypeFields({\n    schemaComposer,\n    nodeStore,\n    parentSpan,\n  })\n  await Promise.all(\n    Array.from(schemaComposer.values()).map(typeComposer =>\n      processTypeComposer({\n        schemaComposer,\n        typeComposer,\n        nodeStore,\n        parentSpan,\n      })\n    )\n  )\n  await addThirdPartySchemas({ schemaComposer, thirdPartySchemas, parentSpan })\n  await addCustomResolveFunctions({ schemaComposer, parentSpan })\n}\n\nconst processTypeComposer = async ({\n  schemaComposer,\n  typeComposer,\n  nodeStore,\n  parentSpan,\n}) => {\n  if (\n    typeComposer instanceof ObjectTypeComposer &&\n    typeComposer.hasInterface(`Node`)\n  ) {\n    await addNodeInterfaceFields({ schemaComposer, typeComposer, parentSpan })\n    await addResolvers({ schemaComposer, typeComposer, parentSpan })\n    await addConvenienceChildrenFields({\n      schemaComposer,\n      typeComposer,\n      nodeStore,\n      parentSpan,\n    })\n    await addTypeToRootQuery({ schemaComposer, typeComposer, parentSpan })\n  }\n}\n\nconst addTypes = ({ schemaComposer, types, parentSpan }) => {\n  types.forEach(({ typeOrTypeDef, plugin }) => {\n    if (typeof typeOrTypeDef === `string`) {\n      let addedTypes\n      try {\n        addedTypes = schemaComposer.addTypeDefs(typeOrTypeDef)\n      } catch (error) {\n        reportParsingError(error)\n      }\n      addedTypes.forEach(type => {\n        processAddedType({\n          schemaComposer,\n          type,\n          parentSpan,\n          createdFrom: `sdl`,\n          plugin,\n        })\n      })\n    } else if (isGatsbyType(typeOrTypeDef)) {\n      const type = createTypeComposerFromGatsbyType({\n        schemaComposer,\n        type: typeOrTypeDef,\n        parentSpan,\n      })\n\n      if (type) {\n        processAddedType({\n          schemaComposer,\n          type,\n          parentSpan,\n          createdFrom: `typeBuilder`,\n          plugin,\n        })\n      }\n    } else {\n      processAddedType({\n        schemaComposer,\n        type: typeOrTypeDef,\n        parentSpan,\n        createdFrom: `graphql-js`,\n        plugin,\n      })\n    }\n  })\n}\n\nconst processAddedType = ({\n  schemaComposer,\n  type,\n  parentSpan,\n  createdFrom,\n  plugin,\n}) => {\n  const typeName = schemaComposer.addAsComposer(type)\n  checkIsAllowedTypeName(typeName)\n  const typeComposer = schemaComposer.get(typeName)\n  if (\n    typeComposer instanceof InterfaceTypeComposer ||\n    typeComposer instanceof UnionTypeComposer\n  ) {\n    if (!typeComposer.getResolveType()) {\n      typeComposer.setResolveType(node => node.internal.type)\n    }\n  }\n  schemaComposer.addSchemaMustHaveType(typeComposer)\n\n  typeComposer.setExtension(`createdFrom`, createdFrom)\n  typeComposer.setExtension(`plugin`, plugin ? plugin.name : null)\n\n  if (createdFrom === `sdl`) {\n    if (type.astNode && type.astNode.directives) {\n      type.astNode.directives.forEach(directive => {\n        if (directive.name.value === `infer`) {\n          typeComposer.setExtension(`infer`, true)\n          typeComposer.setExtension(\n            `addDefaultResolvers`,\n            getNoDefaultResolvers(directive)\n          )\n        } else if (directive.name.value === `dontInfer`) {\n          typeComposer.setExtension(`infer`, false)\n          typeComposer.setExtension(\n            `addDefaultResolvers`,\n            getNoDefaultResolvers(directive)\n          )\n        }\n      })\n    }\n  }\n\n  return typeComposer\n}\n\nconst getNoDefaultResolvers = directive => {\n  const noDefaultResolvers = directive.arguments.find(\n    ({ name }) => name.value === `noDefaultResolvers`\n  )\n  if (noDefaultResolvers) {\n    if (noDefaultResolvers.value.kind === Kind.BOOLEAN) {\n      return !noDefaultResolvers.value.value\n    }\n  }\n\n  return null\n}\n\nconst checkIsAllowedTypeName = name => {\n  invariant(\n    name !== `Node`,\n    `The GraphQL type \\`Node\\` is reserved for internal use.`\n  )\n  invariant(\n    !name.endsWith(`FilterInput`) && !name.endsWith(`SortInput`),\n    `GraphQL type names ending with \"FilterInput\" or \"SortInput\" are ` +\n      `reserved for internal use. Please rename \\`${name}\\`.`\n  )\n  invariant(\n    ![`Boolean`, `Date`, `Float`, `ID`, `Int`, `JSON`, `String`].includes(name),\n    `The GraphQL type \\`${name}\\` is reserved for internal use by ` +\n      `built-in scalar types.`\n  )\n  assertValidName(name)\n}\n\nconst createTypeComposerFromGatsbyType = ({\n  schemaComposer,\n  type,\n  parentSpan,\n}) => {\n  switch (type.kind) {\n    case GatsbyGraphQLTypeKind.OBJECT: {\n      return ObjectTypeComposer.createTemp(\n        {\n          ...type.config,\n          interfaces: () => {\n            if (type.config.interfaces) {\n              return type.config.interfaces.map(iface => {\n                if (typeof iface === `string`) {\n                  return schemaComposer.getIFTC(iface).getType()\n                } else {\n                  return iface\n                }\n              })\n            } else {\n              return []\n            }\n          },\n        },\n        schemaComposer\n      )\n    }\n    case GatsbyGraphQLTypeKind.INPUT_OBJECT: {\n      return InputTypeComposer.createTemp(type.config, schemaComposer)\n    }\n    case GatsbyGraphQLTypeKind.UNION: {\n      return UnionTypeComposer.createTemp(\n        {\n          ...type.config,\n          types: () => {\n            if (type.config.types) {\n              return type.config.types.map(typeName =>\n                schemaComposer.getOTC(typeName).getType()\n              )\n            } else {\n              return []\n            }\n          },\n        },\n        schemaComposer\n      )\n    }\n    case GatsbyGraphQLTypeKind.INTERFACE: {\n      return InterfaceTypeComposer.createTemp(type.config, schemaComposer)\n    }\n    default: {\n      report.warn(`Illegal type definition: ${JSON.stringify(type.config)}`)\n      return null\n    }\n  }\n}\n\nconst addSetFieldsOnGraphQLNodeTypeFields = ({\n  schemaComposer,\n  nodeStore,\n  parentSpan,\n}) =>\n  Promise.all(\n    Array.from(schemaComposer.values()).map(async tc => {\n      if (tc instanceof ObjectTypeComposer && tc.hasInterface(`Node`)) {\n        const typeName = tc.getTypeName()\n        const result = await apiRunner(`setFieldsOnGraphQLNodeType`, {\n          type: {\n            name: typeName,\n            nodes: nodeStore.getNodesByType(typeName),\n          },\n          traceId: `initial-setFieldsOnGraphQLNodeType`,\n          parentSpan: parentSpan,\n        })\n        if (result) {\n          // NOTE: `setFieldsOnGraphQLNodeType` only allows setting\n          // nested fields with a path as property name, i.e.\n          // `{ 'frontmatter.published': 'Boolean' }`, but not in the form\n          // `{ frontmatter: { published: 'Boolean' }}`\n          result.forEach(fields => tc.addNestedFields(fields))\n        }\n      }\n    })\n  )\n\nconst addThirdPartySchemas = ({\n  schemaComposer,\n  thirdPartySchemas,\n  parentSpan,\n}) => {\n  thirdPartySchemas.forEach(schema => {\n    const schemaQueryType = schema.getQueryType()\n    const queryTC = ObjectTypeComposer.createTemp(schemaQueryType)\n    processThirdPartyType({\n      schemaComposer,\n      typeComposer: queryTC,\n      schemaQueryType,\n    })\n    const fields = queryTC.getFields()\n    schemaComposer.Query.addFields(fields)\n\n    // Explicitly add the third-party schema's types, so they can be targeted\n    // in `createResolvers` API.\n    const types = schema.getTypeMap()\n    Object.keys(types).forEach(typeName => {\n      const type = types[typeName]\n      if (\n        type !== schemaQueryType &&\n        !isSpecifiedScalarType(type) &&\n        !isIntrospectionType(type)\n      ) {\n        schemaComposer.addAsComposer(type)\n        const typeComposer = schemaComposer.getAnyTC(type.name)\n        processThirdPartyType({ schemaComposer, typeComposer, schemaQueryType })\n        schemaComposer.addSchemaMustHaveType(typeComposer)\n      }\n    })\n  })\n}\n\nconst processThirdPartyType = ({\n  schemaComposer,\n  typeComposer,\n  schemaQueryType,\n}) => {\n  typeComposer.getType().isThirdPartyType = true\n  // Fix for types that refer to Query. Thanks Relay Classic!\n  if (\n    typeComposer instanceof ObjectTypeComposer ||\n    typeComposer instanceof InterfaceTypeComposer\n  ) {\n    typeComposer.getFieldNames().forEach(fieldName => {\n      const fieldType = typeComposer.getFieldType(fieldName)\n      if (getNamedType(fieldType) === schemaQueryType) {\n        typeComposer.extendField(fieldName, {\n          type: fieldType.toString().replace(schemaQueryType.name, `Query`),\n        })\n      }\n    })\n  }\n  return typeComposer\n}\n\nconst addCustomResolveFunctions = async ({ schemaComposer, parentSpan }) => {\n  const intermediateSchema = schemaComposer.buildSchema()\n  const createResolvers = resolvers => {\n    Object.keys(resolvers).forEach(typeName => {\n      const fields = resolvers[typeName]\n      if (schemaComposer.has(typeName)) {\n        const tc = schemaComposer.getOTC(typeName)\n        Object.keys(fields).forEach(fieldName => {\n          const fieldConfig = fields[fieldName]\n          if (tc.hasField(fieldName)) {\n            const originalFieldConfig = tc.getFieldConfig(fieldName)\n            const originalTypeName = originalFieldConfig.type.toString()\n            const originalResolver = originalFieldConfig.resolve\n            const fieldTypeName =\n              fieldConfig.type && fieldConfig.type.toString()\n            if (\n              !fieldTypeName ||\n              fieldTypeName.replace(/!/g, ``) ===\n                originalTypeName.replace(/!/g, ``) ||\n              tc.getType().isThirdPartyType\n            ) {\n              const newConfig = {}\n              if (fieldConfig.type) {\n                newConfig.type = fieldConfig.type\n              }\n              if (fieldConfig.args) {\n                newConfig.args = fieldConfig.args\n              }\n              if (fieldConfig.resolve) {\n                newConfig.resolve = (source, args, context, info) =>\n                  fieldConfig.resolve(source, args, context, {\n                    ...info,\n                    originalResolver: originalResolver || defaultFieldResolver,\n                  })\n              }\n              tc.extendField(fieldName, newConfig)\n            } else if (fieldTypeName) {\n              report.warn(\n                `\\`createResolvers\\` passed resolvers for field ` +\n                  `\\`${typeName}.${fieldName}\\` with type \\`${fieldTypeName}\\`. ` +\n                  `Such a field with type \\`${originalTypeName}\\` already exists ` +\n                  `on the type. Use \\`createTypes\\` to override type fields.`\n              )\n            }\n          } else {\n            tc.addFields({ [fieldName]: fieldConfig })\n          }\n        })\n      } else {\n        report.warn(\n          `\\`createResolvers\\` passed resolvers for type \\`${typeName}\\` that ` +\n            `doesn't exist in the schema. Use \\`createTypes\\` to add the type ` +\n            `before adding resolvers.`\n        )\n      }\n    })\n  }\n  await apiRunner(`createResolvers`, {\n    schema: intermediateSchema,\n    createResolvers,\n    traceId: `initial-createResolvers`,\n    parentSpan: parentSpan,\n  })\n}\n\nconst addResolvers = ({ schemaComposer, typeComposer }) => {\n  const typeName = typeComposer.getTypeName()\n\n  // TODO: We should have an abstraction for keeping and clearing\n  // related TypeComposers and InputTypeComposers.\n  // Also see the comment on the skipped test in `rebuild-schema`.\n  typeComposer.removeInputTypeComposer()\n\n  const sortInputTC = getSortInput({\n    schemaComposer,\n    typeComposer,\n  })\n  const filterInputTC = getFilterInput({\n    schemaComposer,\n    typeComposer,\n  })\n  const paginationTC = getPagination({\n    schemaComposer,\n    typeComposer,\n  })\n  typeComposer.addResolver({\n    name: `findOne`,\n    type: typeComposer,\n    args: {\n      ...filterInputTC.getFields(),\n    },\n    resolve: findOne(typeName),\n  })\n  typeComposer.addResolver({\n    name: `findManyPaginated`,\n    type: paginationTC,\n    args: {\n      filter: filterInputTC,\n      sort: sortInputTC,\n      skip: `Int`,\n      limit: `Int`,\n      // page: `Int`,\n      // perPage: { type: `Int`, defaultValue: 20 },\n    },\n    resolve: findManyPaginated(typeName),\n  })\n}\n\nconst addConvenienceChildrenFields = ({\n  schemaComposer,\n  typeComposer,\n  nodeStore,\n}) => {\n  const nodes = nodeStore.getNodesByType(typeComposer.getTypeName())\n\n  const childNodesByType = groupChildNodesByType({ nodeStore, nodes })\n\n  Object.keys(childNodesByType).forEach(typeName => {\n    const typeChildren = childNodesByType[typeName]\n    const maxChildCount = _.maxBy(\n      _.values(_.groupBy(typeChildren, c => c.parent)),\n      g => g.length\n    ).length\n\n    if (maxChildCount > 1) {\n      typeComposer.addFields(createChildrenField(typeName))\n    } else {\n      typeComposer.addFields(createChildField(typeName))\n    }\n  })\n}\n\nfunction createChildrenField(typeName) {\n  return {\n    [_.camelCase(`children ${typeName}`)]: {\n      type: () => [typeName],\n      resolve(source, args, context) {\n        const { path } = context\n        return context.nodeModel.getNodesByIds(\n          { ids: source.children, type: typeName },\n          { path }\n        )\n      },\n    },\n  }\n}\n\nfunction createChildField(typeName) {\n  return {\n    [_.camelCase(`child ${typeName}`)]: {\n      type: () => typeName,\n      async resolve(source, args, context) {\n        const { path } = context\n        const result = await context.nodeModel.getNodesByIds(\n          { ids: source.children, type: typeName },\n          { path }\n        )\n        if (result && result.length > 0) {\n          return result[0]\n        } else {\n          return null\n        }\n      },\n    },\n  }\n}\n\nfunction groupChildNodesByType({ nodeStore, nodes }) {\n  return _(nodes)\n    .flatMap(node => (node.children || []).map(nodeStore.getNode))\n    .groupBy(node => (node.internal ? node.internal.type : undefined))\n    .value()\n}\n\nconst addTypeToRootQuery = ({ schemaComposer, typeComposer }) => {\n  const typeName = typeComposer.getTypeName()\n  // not strictly correctly, result is `npmPackage` and `allNpmPackage` from type `NPMPackage`\n  const queryName = _.camelCase(typeName)\n  const queryNamePlural = _.camelCase(`all ${typeName}`)\n  schemaComposer.Query.addFields({\n    [queryName]: typeComposer.getResolver(`findOne`),\n    [queryNamePlural]: typeComposer.getResolver(`findManyPaginated`),\n  })\n}\n\nconst reportParsingError = error => {\n  const { message, source, locations } = error\n\n  if (source && locations && locations.length) {\n    const report = require(`gatsby-cli/lib/reporter`)\n    const { codeFrameColumns } = require(`@babel/code-frame`)\n\n    const frame = codeFrameColumns(\n      source.body,\n      { start: locations[0] },\n      { linesAbove: 5, linesBelow: 5 }\n    )\n    report.panic(\n      `Encountered an error parsing the provided GraphQL type definitions:\\n` +\n        message +\n        `\\n\\n` +\n        frame +\n        `\\n`\n    )\n  } else {\n    throw error\n  }\n}\n"],"file":"schema.js"}