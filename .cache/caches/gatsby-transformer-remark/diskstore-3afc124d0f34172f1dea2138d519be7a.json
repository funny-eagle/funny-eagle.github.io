{"expireTime":9007200811184863000,"key":"transformer-remark-markdown-html-ast-76b5062cd776141ba5a74a7a0b3269cd-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Algorithm","position":{"start":{"line":2,"column":4,"offset":4},"end":{"line":2,"column":13,"offset":13}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":13,"offset":13}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>nocoder<span class=\"token punctuation\">.</span>leetcode<span class=\"token punctuation\">.</span>solution</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * 709. To Lower Case\n * &lt;p>\n * Implement function ToLowerCase() that has a string parameter str, and returns the same string in lowercase.\n * &lt;p>\n * Example 1:\n * &lt;p>\n * Input: \"Hello\"\n * Output: \"hello\"\n * Example 2:\n * &lt;p>\n * Input: \"here\"\n * Output: \"here\"\n * Example 3:\n * &lt;p>\n * Input: \"LOVELY\"\n * Output: \"lovely\"\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ToLowerCase</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> str<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">StringBuilder</span> lowerCase <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> chars <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">toCharArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> chars<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> chars<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">>=</span> <span class=\"token number\">65</span> <span class=\"token operator\">&amp;&amp;</span> n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                n <span class=\"token operator\">+=</span> <span class=\"token number\">32</span><span class=\"token punctuation\">;</span>\n                lowerCase<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span> n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                lowerCase<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span> n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> lowerCase<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":4,"column":1,"offset":15},"end":{"line":45,"column":4,"offset":992}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Review","position":{"start":{"line":49,"column":4,"offset":999},"end":{"line":49,"column":10,"offset":1005}}}],"position":{"start":{"line":49,"column":1,"offset":996},"end":{"line":49,"column":10,"offset":1005}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://netty.io/wiki/user-guide-for-4.x.html#wiki-h2-0"},"children":[{"type":"text","value":"User guide for 4.x","position":{"start":{"line":51,"column":2,"offset":1008},"end":{"line":51,"column":20,"offset":1026}}}],"position":{"start":{"line":51,"column":1,"offset":1007},"end":{"line":51,"column":78,"offset":1084}}}],"position":{"start":{"line":51,"column":1,"offset":1007},"end":{"line":51,"column":78,"offset":1084}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Tip","position":{"start":{"line":53,"column":4,"offset":1089},"end":{"line":53,"column":7,"offset":1092}}}],"position":{"start":{"line":53,"column":1,"offset":1086},"end":{"line":53,"column":7,"offset":1092}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"寻找相似图片","position":{"start":{"line":55,"column":5,"offset":1098},"end":{"line":55,"column":11,"offset":1104}}}],"position":{"start":{"line":55,"column":1,"offset":1094},"end":{"line":55,"column":11,"offset":1104}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"接上周的图书图片爬虫引发的问题，图片爬下来以后，有不少“暂无图片”的图片，而且部分这些图片的命名还没有规律可循，所以没办法在爬取的时候就过滤掉。我使用了中间表来保存图书的信息及图片在本地的路径，所以可以找到对应关系，从而对类似“暂无图片”的图片进行删除。","position":{"start":{"line":57,"column":1,"offset":1106},"end":{"line":57,"column":128,"offset":1233}}}],"position":{"start":{"line":57,"column":1,"offset":1106},"end":{"line":57,"column":128,"offset":1233}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"问题就在于如何快速的找到这些“暂无图片”图片，我的想法是通过找相似图片的方式，以一个图片找到其他类似的图片，在网上搜索了一下，找到了阮一峰老师的这篇文章。","position":{"start":{"line":59,"column":1,"offset":1235},"end":{"line":59,"column":78,"offset":1312}}}],"position":{"start":{"line":59,"column":1,"offset":1235},"end":{"line":59,"column":78,"offset":1312}}},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://www.ruanyifeng.com/blog/2011/07/principle_of_similar_image_search.html"},"children":[{"type":"text","value":"相似图片搜索的原理-阮一峰","position":{"start":{"line":61,"column":4,"offset":1317},"end":{"line":61,"column":17,"offset":1330}}}],"position":{"start":{"line":61,"column":3,"offset":1316},"end":{"line":61,"column":97,"offset":1410}}}],"position":{"start":{"line":61,"column":3,"offset":1316},"end":{"line":61,"column":97,"offset":1410}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这里的关键技术叫做”感知哈希算法”（Perceptual hash algorithm），它的作用是对每张图片生成一个”指纹”（fingerprint）字符串，然后比较不同图片的指纹。结果越接近，就说明图片越相似。","position":{"start":{"line":63,"column":3,"offset":1415},"end":{"line":63,"column":110,"offset":1522}}}],"position":{"start":{"line":63,"column":3,"offset":1415},"end":{"line":63,"column":110,"offset":1522}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"下面是一个最简单的实现：","position":{"start":{"line":65,"column":3,"offset":1527},"end":{"line":65,"column":15,"offset":1539}}}],"position":{"start":{"line":65,"column":3,"offset":1527},"end":{"line":65,"column":15,"offset":1539}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"第一步，缩小尺寸。","position":{"start":{"line":67,"column":5,"offset":1546},"end":{"line":67,"column":14,"offset":1555}}}],"position":{"start":{"line":67,"column":3,"offset":1544},"end":{"line":67,"column":16,"offset":1557}}}],"position":{"start":{"line":67,"column":3,"offset":1544},"end":{"line":67,"column":16,"offset":1557}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将图片缩小到8x8的尺寸，总共64个像素。这一步的作用是去除图片的细节，只保留结构、明暗等基本信息，摒弃不同尺寸、比例带来的图片差异。","position":{"start":{"line":69,"column":3,"offset":1562},"end":{"line":69,"column":70,"offset":1629}}}],"position":{"start":{"line":69,"column":3,"offset":1562},"end":{"line":69,"column":70,"offset":1629}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"第二步，简化色彩。","position":{"start":{"line":71,"column":5,"offset":1636},"end":{"line":71,"column":14,"offset":1645}}}],"position":{"start":{"line":71,"column":3,"offset":1634},"end":{"line":71,"column":16,"offset":1647}}}],"position":{"start":{"line":71,"column":3,"offset":1634},"end":{"line":71,"column":16,"offset":1647}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将缩小后的图片，转为64级灰度。也就是说，所有像素点总共只有64种颜色。","position":{"start":{"line":73,"column":3,"offset":1652},"end":{"line":73,"column":39,"offset":1688}}}],"position":{"start":{"line":73,"column":3,"offset":1652},"end":{"line":73,"column":39,"offset":1688}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"第三步，计算平均值。","position":{"start":{"line":75,"column":5,"offset":1695},"end":{"line":75,"column":15,"offset":1705}}}],"position":{"start":{"line":75,"column":3,"offset":1693},"end":{"line":75,"column":17,"offset":1707}}}],"position":{"start":{"line":75,"column":3,"offset":1693},"end":{"line":75,"column":17,"offset":1707}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"计算所有64个像素的灰度平均值。","position":{"start":{"line":77,"column":3,"offset":1712},"end":{"line":77,"column":19,"offset":1728}}}],"position":{"start":{"line":77,"column":3,"offset":1712},"end":{"line":77,"column":19,"offset":1728}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"第四步，比较像素的灰度。","position":{"start":{"line":79,"column":5,"offset":1735},"end":{"line":79,"column":17,"offset":1747}}}],"position":{"start":{"line":79,"column":3,"offset":1733},"end":{"line":79,"column":19,"offset":1749}}}],"position":{"start":{"line":79,"column":3,"offset":1733},"end":{"line":79,"column":19,"offset":1749}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将每个像素的灰度，与平均值进行比较。大于或等于平均值，记为1；小于平均值，记为0。","position":{"start":{"line":81,"column":3,"offset":1754},"end":{"line":81,"column":44,"offset":1795}}}],"position":{"start":{"line":81,"column":3,"offset":1754},"end":{"line":81,"column":44,"offset":1795}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"第五步，计算哈希值。","position":{"start":{"line":83,"column":5,"offset":1802},"end":{"line":83,"column":15,"offset":1812}}}],"position":{"start":{"line":83,"column":3,"offset":1800},"end":{"line":83,"column":17,"offset":1814}}}],"position":{"start":{"line":83,"column":3,"offset":1800},"end":{"line":83,"column":17,"offset":1814}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将上一步的比较结果，组合在一起，就构成了一个64位的整数，这就是这张图片的指纹。组合的次序并不重要，只要保证所有图片都采用同样次序就行了。","position":{"start":{"line":85,"column":3,"offset":1819},"end":{"line":85,"column":72,"offset":1888}}}],"position":{"start":{"line":85,"column":3,"offset":1819},"end":{"line":85,"column":72,"offset":1888}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"得到指纹以后，就可以对比不同的图片，看看64位中有多少位是不一样的。在理论上，这等同于计算","position":{"start":{"line":87,"column":3,"offset":1893},"end":{"line":87,"column":48,"offset":1938}}},{"type":"element","tagName":"a","properties":{"href":"http://zh.wikipedia.org/wiki/%E6%B1%89%E6%98%8E%E8%B7%9D%E7%A6%BB"},"children":[{"type":"text","value":"“汉明距离”","position":{"start":{"line":87,"column":49,"offset":1939},"end":{"line":87,"column":55,"offset":1945}}}],"position":{"start":{"line":87,"column":48,"offset":1938},"end":{"line":87,"column":123,"offset":2013}}},{"type":"text","value":"（Hamming distance）。如果不相同的数据位不超过5，就说明两张图片很相似；如果大于10，就说明这是两张不同的图片。","position":{"start":{"line":87,"column":123,"offset":2013},"end":{"line":87,"column":187,"offset":2077}}}],"position":{"start":{"line":87,"column":3,"offset":1893},"end":{"line":87,"column":187,"offset":2077}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"具体的代码实现，可以参见","position":{"start":{"line":89,"column":3,"offset":2082},"end":{"line":89,"column":15,"offset":2094}}},{"type":"element","tagName":"a","properties":{"href":"http://www.reddit.com/r/programming/comments/hql8b/looks_like_it_for_the_last_few_months_i_have_had/c1xkcdd"},"children":[{"type":"text","value":"Wote","position":{"start":{"line":89,"column":16,"offset":2095},"end":{"line":89,"column":20,"offset":2099}}}],"position":{"start":{"line":89,"column":15,"offset":2094},"end":{"line":89,"column":130,"offset":2209}}},{"type":"text","value":"用python语言写的","position":{"start":{"line":89,"column":130,"offset":2209},"end":{"line":89,"column":141,"offset":2220}}},{"type":"element","tagName":"a","properties":{"href":"http://www.ruanyifeng.com/blog/2011/07/imgHash.txt"},"children":[{"type":"text","value":"imgHash.py","position":{"start":{"line":89,"column":142,"offset":2221},"end":{"line":89,"column":152,"offset":2231}}}],"position":{"start":{"line":89,"column":141,"offset":2220},"end":{"line":89,"column":205,"offset":2284}}},{"type":"text","value":"。代码很短，只有53行。使用的时候，第一个参数是基准图片，第二个参数是用来比较的其他图片所在的目录，返回结果是两张图片之间不相同的数据位数量（汉明距离）。","position":{"start":{"line":89,"column":205,"offset":2284},"end":{"line":89,"column":282,"offset":2361}}}],"position":{"start":{"line":89,"column":3,"offset":2082},"end":{"line":89,"column":282,"offset":2361}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这种算法的优点是简单快速，不受图片大小缩放的影响，缺点是图片的内容不能变更。如果在图片上加几个文字，它就认不出来了。所以，它的最佳用途是根据缩略图，找出原图。","position":{"start":{"line":91,"column":3,"offset":2366},"end":{"line":91,"column":82,"offset":2445}}}],"position":{"start":{"line":91,"column":3,"offset":2366},"end":{"line":91,"column":82,"offset":2445}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"实际应用中，往往采用更强大的","position":{"start":{"line":93,"column":3,"offset":2450},"end":{"line":93,"column":17,"offset":2464}}},{"type":"element","tagName":"a","properties":{"href":"http://www.phash.org/"},"children":[{"type":"text","value":"pHash","position":{"start":{"line":93,"column":18,"offset":2465},"end":{"line":93,"column":23,"offset":2470}}}],"position":{"start":{"line":93,"column":17,"offset":2464},"end":{"line":93,"column":47,"offset":2494}}},{"type":"text","value":"算法和","position":{"start":{"line":93,"column":47,"offset":2494},"end":{"line":93,"column":50,"offset":2497}}},{"type":"element","tagName":"a","properties":{"href":"http://en.wikipedia.org/wiki/Scale-invariant_feature_transform"},"children":[{"type":"text","value":"SIFT","position":{"start":{"line":93,"column":51,"offset":2498},"end":{"line":93,"column":55,"offset":2502}}}],"position":{"start":{"line":93,"column":50,"offset":2497},"end":{"line":93,"column":120,"offset":2567}}},{"type":"text","value":"算法，它们能够识别图片的变形。只要变形程度不超过25%，它们就能匹配原图。这些算法虽然更复杂，但是原理与上面的简便算法是一样的，就是先将图片转化成Hash字符串，然后再进行比较。","position":{"start":{"line":93,"column":120,"offset":2567},"end":{"line":93,"column":209,"offset":2656}}}],"position":{"start":{"line":93,"column":3,"offset":2450},"end":{"line":93,"column":209,"offset":2656}}},{"type":"text","value":"\n"}],"position":{"start":{"line":61,"column":1,"offset":1314},"end":{"line":93,"column":209,"offset":2656}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":" ","position":{"start":{"line":97,"column":1,"offset":2660},"end":{"line":97,"column":2,"offset":2661}}},{"type":"element","tagName":"a","properties":{"href":"http://www.ruanyifeng.com/blog/2011/07/imgHash.txt"},"children":[{"type":"text","value":"imgHash.py ","position":{"start":{"line":97,"column":3,"offset":2662},"end":{"line":97,"column":14,"offset":2673}}}],"position":{"start":{"line":97,"column":2,"offset":2661},"end":{"line":97,"column":67,"offset":2726}}},{"type":"text","value":" 是","position":{"start":{"line":97,"column":67,"offset":2726},"end":{"line":97,"column":69,"offset":2728}}},{"type":"raw","value":"<code class=\"language-text\">python2</code>","position":{"start":{"line":97,"column":69,"offset":2728},"end":{"line":97,"column":78,"offset":2737}}},{"type":"text","value":" 版本的，我稍微调整了一下，改成","position":{"start":{"line":97,"column":78,"offset":2737},"end":{"line":97,"column":94,"offset":2753}}},{"type":"raw","value":"<code class=\"language-text\">python3</code>","position":{"start":{"line":97,"column":94,"offset":2753},"end":{"line":97,"column":103,"offset":2762}}},{"type":"text","value":"版本并在windows 机器上运行了一下，效果很不错。","position":{"start":{"line":97,"column":103,"offset":2762},"end":{"line":97,"column":130,"offset":2789}}}],"position":{"start":{"line":97,"column":1,"offset":2660},"end":{"line":97,"column":130,"offset":2789}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/python</span>\n\n<span class=\"token keyword\">import</span> glob\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">from</span> functools <span class=\"token keyword\">import</span> <span class=\"token builtin\">reduce</span>\n<span class=\"token keyword\">from</span> PIL <span class=\"token keyword\">import</span> Image\n\n\nEXTS <span class=\"token operator\">=</span> <span class=\"token string\">'jpg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'jpeg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'gif'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'png'</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">avhash</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> Image<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        im <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">)</span>\n    im <span class=\"token operator\">=</span> im<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> Image<span class=\"token punctuation\">.</span>ANTIALIAS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'L'</span><span class=\"token punctuation\">)</span>\n    avg <span class=\"token operator\">=</span> <span class=\"token builtin\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> x <span class=\"token operator\">+</span> y<span class=\"token punctuation\">,</span> im<span class=\"token punctuation\">.</span>getdata<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">64</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">,</span> y_z<span class=\"token punctuation\">:</span> x <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>y_z<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;&lt;</span> y_z<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> i<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token keyword\">if</span> i <span class=\"token operator\">&lt;</span> avg <span class=\"token keyword\">else</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> im<span class=\"token punctuation\">.</span>getdata<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">hamming</span><span class=\"token punctuation\">(</span>h1<span class=\"token punctuation\">,</span> h2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    h<span class=\"token punctuation\">,</span> d <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> h1 <span class=\"token operator\">^</span> h2\n    <span class=\"token keyword\">while</span> d<span class=\"token punctuation\">:</span>\n        h <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        d <span class=\"token operator\">&amp;</span><span class=\"token operator\">=</span> d <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">return</span> h\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">find_similar_img</span><span class=\"token punctuation\">(</span>img_path<span class=\"token punctuation\">,</span> dest_dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        h <span class=\"token operator\">=</span> avhash<span class=\"token punctuation\">(</span>img_path<span class=\"token punctuation\">)</span>\n        os<span class=\"token punctuation\">.</span>chdir<span class=\"token punctuation\">(</span>dest_dir<span class=\"token punctuation\">)</span>\n        images <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">for</span> ext <span class=\"token keyword\">in</span> EXTS<span class=\"token punctuation\">:</span>\n            images<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span>glob<span class=\"token punctuation\">.</span>glob<span class=\"token punctuation\">(</span><span class=\"token string\">'*.%s'</span> <span class=\"token operator\">%</span> ext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        seq <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        prog <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>images<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">50</span> <span class=\"token keyword\">and</span> sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>isatty<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> f <span class=\"token keyword\">in</span> images<span class=\"token punctuation\">:</span>\n            seq<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> hamming<span class=\"token punctuation\">(</span>avhash<span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> prog<span class=\"token punctuation\">:</span>\n                perc <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">.</span> <span class=\"token operator\">*</span> prog <span class=\"token operator\">/</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>images<span class=\"token punctuation\">)</span>\n                x <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> perc <span class=\"token operator\">/</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\rCalculating... ['</span> <span class=\"token operator\">+</span> <span class=\"token string\">'#'</span> <span class=\"token operator\">*</span> x <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">40</span> <span class=\"token operator\">-</span> x<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">']'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'%.2f%%'</span> <span class=\"token operator\">%</span> perc<span class=\"token punctuation\">,</span> <span class=\"token string\">'(%d/%d)'</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>images<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>flush<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                prog <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\n        <span class=\"token keyword\">if</span> prog<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span>\n\n        <span class=\"token keyword\">for</span> f<span class=\"token punctuation\">,</span> ham <span class=\"token keyword\">in</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>seq<span class=\"token punctuation\">,</span> key<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> i<span class=\"token punctuation\">:</span> i<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> ham <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\\t%s%s%s\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>ham<span class=\"token punctuation\">,</span> dest_dir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\\\"</span><span class=\"token punctuation\">,</span> f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> root<span class=\"token punctuation\">,</span> dirs<span class=\"token punctuation\">,</span> files <span class=\"token keyword\">in</span> os<span class=\"token punctuation\">.</span>walk<span class=\"token punctuation\">(</span><span class=\"token string\">'F:\\\\image\\\\2019-01-03'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        find_similar_img<span class=\"token punctuation\">(</span><span class=\"token string\">'D:\\\\usr\\\\local\\\\github\\\\imgHash\\\\no-img.jpg'</span><span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span></code></pre></div>","position":{"start":{"line":99,"column":1,"offset":2791},"end":{"line":161,"column":4,"offset":4427}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"output:","position":{"start":{"line":163,"column":1,"offset":4429},"end":{"line":163,"column":8,"offset":4436}}}],"position":{"start":{"line":163,"column":1,"offset":4429},"end":{"line":163,"column":8,"offset":4436}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">D:\\usr\\local\\github\\imgHash\\venv\\Scripts\\python.exe D:/usr/local/github/imgHash/imgHash.py\n0\tF:\\image\\2019-01-03\\0\\9787555502739.jpg\n0\tF:\\image\\2019-01-03\\0\\9787555705956.jpg\n0\tF:\\image\\2019-01-03\\0\\9787558102141.jpg\n0\tF:\\image\\2019-01-03\\0\\9787558104916.jpg\n0\tF:\\image\\2019-01-03\\0\\9787558107627.jpg\n0\tF:\\image\\2019-01-03\\0\\9787801767912.jpg\n0\tF:\\image\\2019-01-03\\0\\9787806193433.jpg\n0\tF:\\image\\2019-01-03\\1\\9787509536063.jpg\n0\tF:\\image\\2019-01-03\\1\\9787511238757.jpg\n0\tF:\\image\\2019-01-03\\1\\9787514321104.jpg\n0\tF:\\image\\2019-01-03\\1\\9787514324389.jpg\n0\tF:\\image\\2019-01-03\\1\\9787530573099.jpg\n0\tF:\\image\\2019-01-03\\1\\9787546632865.jpg\n0\tF:\\image\\2019-01-03\\1\\9787546952581.jpg\n0\tF:\\image\\2019-01-03\\1\\9787549817719.jpg\n0\tF:\\image\\2019-01-03\\1\\9787553458199.jpg\n0\tF:\\image\\2019-01-03\\1\\9787558102387.jpg\n0\tF:\\image\\2019-01-03\\1\\9787560561981.jpg\n0\tF:\\image\\2019-01-03\\2\\9787511247278.jpg\n0\tF:\\image\\2019-01-03\\2\\9787511353801.jpg\n0\tF:\\image\\2019-01-03\\2\\9787513909280.jpg</code></pre></div>","position":{"start":{"line":165,"column":1,"offset":4438},"end":{"line":188,"column":4,"offset":5423}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Share","position":{"start":{"line":192,"column":4,"offset":5430},"end":{"line":192,"column":9,"offset":5435}}}],"position":{"start":{"line":192,"column":1,"offset":5427},"end":{"line":192,"column":9,"offset":5435}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"分享几个图片处理算法的文章，非常有意思","position":{"start":{"line":194,"column":1,"offset":5437},"end":{"line":194,"column":20,"offset":5456}}}],"position":{"start":{"line":194,"column":1,"offset":5437},"end":{"line":194,"column":20,"offset":5456}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://www.ruanyifeng.com/blog/2011/07/principle_of_similar_image_search.html"},"children":[{"type":"text","value":"相似图片搜索的原理","position":{"start":{"line":196,"column":2,"offset":5459},"end":{"line":196,"column":11,"offset":5468}}}],"position":{"start":{"line":196,"column":1,"offset":5458},"end":{"line":196,"column":91,"offset":5548}}}],"position":{"start":{"line":196,"column":1,"offset":5458},"end":{"line":196,"column":91,"offset":5548}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://www.ruanyifeng.com/blog/2013/03/similar_image_search_part_ii.html"},"children":[{"type":"text","value":"相似图片搜索的原理（二）","position":{"start":{"line":198,"column":2,"offset":5551},"end":{"line":198,"column":14,"offset":5563}}}],"position":{"start":{"line":198,"column":1,"offset":5550},"end":{"line":198,"column":89,"offset":5638}}}],"position":{"start":{"line":198,"column":1,"offset":5550},"end":{"line":198,"column":89,"offset":5638}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://www.ruanyifeng.com/blog/2011/08/amazing_algorithms_of_image_processing.html"},"children":[{"type":"text","value":"神奇的图像处理算法","position":{"start":{"line":200,"column":2,"offset":5641},"end":{"line":200,"column":11,"offset":5650}}}],"position":{"start":{"line":200,"column":1,"offset":5640},"end":{"line":200,"column":96,"offset":5735}}}],"position":{"start":{"line":200,"column":1,"offset":5640},"end":{"line":200,"column":96,"offset":5735}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":200,"column":96,"offset":5735}}}}